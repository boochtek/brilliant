require "rattler"

parser Brilliant::Parser < Rattler::Runtime::ExtendedPackratParser

%start program

%whitespace ( SPACE+ / comment )*  {
    program             <- expression+ EOF                                                  <AST::Program.new>

    identifier          <- @( ( ALPHA / '_' ) ( WORD / '!' / '?' )* )

    expression          <- literal / function_call / function_definition / return
    function_call       <- identifier ~'(' arg_list ~')'                                    <AST::FunctionCall.new>
    arg_list            <- ( expression? / expression ',' arg_list )

    literal             <- literal_text / literal_integer
    literal_text        <- @( quoted_text )                                                 <AST::LiteralText.new>
    literal_integer     <- @DIGIT+                                                          <AST::LiteralInteger.new>
    quoted_text         <- ~'"' ( !'"' . )* ~'"'

    function_definition <- identifier ~'=' ~'function' function_signature code_block        <AST::FunctionDefinition.new>
    function_signature  <- ~'(' ~')' ~':' identifier                                        <AST::FunctionSignature.new>
    code_block          <- ~'{' expression+ ~'}'                                            <AST::CodeBlock.new>
    return              <- ~'return' expression                                             <AST::Return.new>
}
comment                 <- ~([#] [^\n]*)
